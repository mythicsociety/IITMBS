<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L8.5: Side effects in pseudocodes for lists and dictionaries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .active-link {
            background-color: #1D4ED8; /* bg-blue-700 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Mobile Header -->
    <header class="lg:hidden fixed top-0 left-0 right-0 bg-blue-600 text-white p-4 z-50 flex justify-between items-center shadow-md">
        <h1 class="text-xl font-bold">L8.5: Side Effects</h1>
        <button id="hamburger-menu" class="hamburger-icon z-50 space-y-2">
            <span class="block w-8 h-0.5 bg-white"></span>
            <span class="block w-8 h-0.5 bg-white"></span>
            <span class="block w-8 h-0.5 bg-white"></span>
        </button>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-blue-600 text-white p-6 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40 lg:pt-6 pt-20 overflow-y-auto">
            <h2 class="text-2xl font-bold mb-8">Navigation</h2>
            <nav id="nav-links">
                <a href="#introduction" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700 hover:text-white">Introduction</a>
                <a href="#unintentional-effects" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700 hover:text-white">Unintentional Side Effects</a>
                <a href="#intentional-effects" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700 hover:text-white">Intentional Side Effects</a>
                <a href="#interactive-demo" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700 hover:text-white">Interactive Demo</a>
                <a href="#summary" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700 hover:text-white">Summary</a>
                <a href="#quiz" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-blue-700 hover:text-white">Knowledge Check</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="lg:ml-64 p-6 md:p-10 w-full mt-16 lg:mt-0">
            <section id="introduction" class="mb-12 bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-4xl font-bold mb-4 text-blue-800">L8.5: Side Effects in Pseudocodes for Lists and Dictionaries</h1>
                <p class="text-lg">Welcome to our final lesson for the week. When we design procedures that operate on collections like lists and dictionaries, we must be mindful of a critical concept: <strong>side effects</strong>.</p>
                <p class="text-lg mt-4">A side effect is any change a procedure makes to its inputs that persists after the procedure has finished. Sometimes these changes are unintentional and can lead to bugs, while other times they are the intended purpose of the procedure. Understanding how to identify, avoid, and properly use side effects is essential for writing robust and predictable algorithms.</p>
            </section>

            <section id="unintentional-effects" class="mb-12 bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-blue-800">Unintentional (and Undesirable) Side Effects</h2>
                <p class="text-lg mb-4">An unintentional side effect happens when a procedure modifies an input collection when it wasn't supposed to. This often occurs when trying to optimize an algorithm.</p>
                <div class="bg-red-50 border-2 border-red-200 p-6 rounded-lg shadow-sm mt-6">
                    <h3 class="text-2xl font-semibold text-red-800">Example: Finding Overlap in Sorted Lists</h3>
                    <p class="text-lg mt-2">To find common items in two sorted lists, an efficient method is to advance pointers through each list, rather than using a slow nested loop. However, a naive implementation of this might modify the original lists by "consuming" them.</p>
                    <p class="text-lg mt-2">If a procedure `FindOverlap(list1, list2)` is called, the person calling it expects `list1` and `list2` to be unchanged afterward. If the procedure modifies them, it has produced an undesirable side effect.</p>
                </div>
                <div class="mt-8 border-l-4 border-blue-500 p-4">
                    <p class="text-lg font-semibold">The Solution: Make a Local Copy</p>
                    <p class="text-lg">To prevent this, the procedure should make a <strong>local copy</strong> of any input it needs to modify. By working on the copy, it can perform its optimizations without affecting the original data that was passed to it.</p>
                    <pre class="bg-gray-800 text-white p-4 rounded-md mt-2"><code>Procedure FindOverlap(l1, l2)
    // Create a local copy to avoid side effects
    my_l2 = l2 
    
    // ... proceed with the algorithm using my_l2 ...
End Procedure</code></pre>
                </div>
            </section>
            
            <section id="intentional-effects" class="mb-12 bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-blue-800">Intentional Side Effects: "In-Place" Operations</h2>
                <p class="text-lg mb-4">Sometimes, the entire purpose of a procedure is to modify the input collection. This is known as an "in-place" operation, and it's an intentional side effect.</p>
                <div class="grid md:grid-cols-2 gap-6 mt-6">
                    <div class="bg-green-50 border-2 border-green-200 p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold text-green-800">Example: Deleting a Key</h3>
                        <p class="text-lg mt-2">A procedure like `DeleteKey(myDict, key)` is expected to permanently remove the key from `myDict`. This modification is the goal.</p>
                    </div>
                    <div class="bg-green-50 border-2 border-green-200 p-6 rounded-lg shadow-sm">
                        <h3 class="text-2xl font-semibold text-green-800">Example: Sorting a List</h3>
                        <p class="text-lg mt-2">Similarly, a procedure `Sort(myList)` might be designed to reorder the elements of `myList` directly, rather than returning a new, sorted list.</p>
                    </div>
                </div>
                <div class="mt-8">
                    <h3 class="text-2xl font-semibold text-gray-700">Alternative: Returning a New Collection</h3>
                    <p class="text-lg mt-2">Even when modification is intended, it's often safer to write procedures that do not have side effects. Instead of modifying the input, the procedure can return a <strong>new, modified collection</strong>.</p>
                    <pre class="bg-gray-800 text-white p-4 rounded-md mt-2"><code>// This procedure returns a NEW dictionary without the key
Procedure DeleteKey_NoSideEffect(d, k)
    new_d = {}
    // ... logic to copy d to new_d, skipping k ...
    return(new_d)
End Procedure

// How to use it:
myDict = DeleteKey_NoSideEffect(myDict, "key_to_delete")</code></pre>
                    <p class="text-lg mt-2">This approach is often preferred because it makes the flow of data explicit: the change only takes effect because you reassign the variable (`myDict = ...`).</p>
                </div>
            </section>

            <section id="interactive-demo" class="mb-12 bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-blue-800">Interactive Side Effect Demo</h2>
                <p class="text-lg mb-4">This tool demonstrates the difference between an in-place operation (with a side effect) and an operation that returns a new copy. Notice how the "Original List" is only affected when the procedure with the side effect is run.</p>
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <div class="mb-4">
                        <h3 class="font-semibold mb-2">Original List:</h3>
                        <div id="original-list" class="bg-white p-3 rounded-md border font-mono">[8, 2, 9, 4, 5]</div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="sort-inplace-btn" class="bg-red-600 text-white px-5 py-2 rounded-md hover:bg-red-700 transition font-semibold">Run Sort_InPlace()</button>
                        <button id="sort-copy-btn" class="bg-blue-600 text-white px-5 py-2 rounded-md hover:bg-blue-700 transition font-semibold">Run Sort_And_Return_Copy()</button>
                    </div>
                    <div id="demo-output" class="mt-4"></div>
                </div>
            </section>

            <section id="summary" class="mb-12 bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-blue-800">Summary</h2>
                <p class="text-lg mb-4">Managing side effects is a crucial aspect of writing clear and reliable pseudocode.</p>
                <ul class="list-disc list-inside text-lg space-y-3 pl-4">
                    <li><strong>Be Careful:</strong> Always be aware of whether a procedure might modify the collections you pass into it.</li>
                    <li><strong>Avoid Unintentional Effects:</strong> The safest way to prevent accidental modification is to make a local copy of the input collection inside your procedure before working with it.</li>
                    <li><strong>Intentional Effects:</strong> Some procedures, like sorting or deleting, are designed to modify data in-place. This is an intentional side effect and should be clearly documented.</li>
                    <li><strong>Prefer Returning Copies:</strong> A common and safe programming pattern is to avoid side effects altogether by having procedures return a new, modified collection, which the caller can then use to explicitly update their variables.</li>
                </ul>
            </section>

            <section id="quiz" class="mb-12 bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold mb-6 text-blue-800">Knowledge Check 🧠</h2>
                <p class="text-lg mb-6">Let's test your understanding of these concepts.</p>
                <div id="quiz-container" class="space-y-8"></div>
                <div id="quiz-results" class="mt-8 text-2xl font-bold"></div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Sidebar and navigation logic ---
            const sidebar = document.getElementById('sidebar');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const navLinks = document.querySelectorAll('#nav-links a');
            const sections = document.querySelectorAll('main section');

            hamburgerMenu.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 1024) {
                        sidebar.classList.add('-translate-x-full');
                    }
                });
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.remove('active-link');
                            if (link.getAttribute('href').substring(1) === entry.target.id) {
                                link.classList.add('active-link');
                            }
                        });
                    }
                });
            }, { rootMargin: "-50% 0px -50% 0px" });

            sections.forEach(section => observer.observe(section));

            // --- Interactive Side Effect Demo ---
            const originalListDiv = document.getElementById('original-list');
            const sortInplaceBtn = document.getElementById('sort-inplace-btn');
            const sortCopyBtn = document.getElementById('sort-copy-btn');
            const demoOutput = document.getElementById('demo-output');
            let originalList = [8, 2, 9, 4, 5];

            function updateOriginalListDisplay() {
                originalListDiv.textContent = `[${originalList.join(', ')}]`;
            }

            sortInplaceBtn.addEventListener('click', () => {
                // This simulates a side effect by modifying the original array
                originalList.sort((a, b) => a - b);
                updateOriginalListDisplay();
                demoOutput.innerHTML = `
                    <h3 class="text-xl font-semibold">Result:</h3>
                    <p>The procedure modified the original list directly.</p>
                    <p class="font-mono mt-2">Returned Value: (none)</p>
                `;
            });

            sortCopyBtn.addEventListener('click', () => {
                // This simulates avoiding a side effect by working on a copy
                const listCopy = [...originalList];
                listCopy.sort((a, b) => a - b);
                updateOriginalListDisplay(); // Original list is unchanged
                demoOutput.innerHTML = `
                    <h3 class="text-xl font-semibold">Result:</h3>
                    <p>The procedure worked on a copy and did not change the original list.</p>
                    <p class="font-mono mt-2">Returned Value: [${listCopy.join(', ')}]</p>
                `;
            });


            // --- Quiz Logic ---
            const quizContainer = document.getElementById('quiz-container');
            const quizResults = document.getElementById('quiz-results');
            let score = 0;

            const quizQuestions = [
                // --- Benchmark Questions from AQ8_5.docx ---
                {
                    question: "Undesirable side effects can be avoided by suitably modifying the pseudocode.",
                    type: "true-false",
                    answers: ["True", "False"],
                    correct: ["True"],
                    explanation: "Yes, for example, by creating a local copy of an input collection before modifying it, you can prevent changes to the original data."
                },
                {
                    question: "Identify the procedures which create a side effect. (Select all that apply)",
                    type: "multiple-choice",
                    answers: ["Finding maximum value in a list.", "Sorting the list in ascending order", "Deleting keys from dictionary", "Merging two dictionaries, D1 and D2, and storing it in D3", "Updating a list or dictionary"],
                    correct: ["Sorting the list in ascending order", "Deleting keys from dictionary", "Updating a list or dictionary"],
                    explanation: "Sorting, deleting, and updating are operations that are often performed 'in-place', meaning they modify the original collection. Finding a max value or merging into a new collection (D3) does not modify the original inputs."
                },
                // --- New Questions ---
                {
                    question: "What is the safest way for a procedure to avoid an unintentional side effect on a list it receives as input?",
                    type: "single-choice",
                    answers: ["Read from the list but never write to it.", "Return an error if the list is too long.", "Create a local copy of the list and only modify the copy.", "Ask the user for permission before modifying the list."],
                    correct: ["Create a local copy of the list and only modify the copy."],
                    explanation: "Making a local copy is the standard technique to ensure the original data passed to the procedure remains unchanged."
                },
                {
                    question: "A procedure that takes a dictionary `d` as input and returns a new dictionary `d2` containing only the items from `d` with values greater than 100 has a side effect.",
                    type: "true-false",
                    answers: ["True", "False"],
                    correct: ["False"],
                    explanation: "This procedure does not have a side effect because it does not modify the original dictionary `d`. It creates and returns a completely new dictionary."
                },
                {
                    question: "Which of the following describes an 'in-place' operation?",
                    type: "single-choice",
                    answers: ["An operation that creates a new collection.", "An operation that reads data without changing it.", "An operation that modifies the input collection directly.", "An operation that only works on numbers."],
                    correct: ["An operation that modifies the input collection directly."],
                    explanation: "'In-place' means the operation is performed on the original data structure, altering it as a side effect."
                },
                {
                    question: "If a procedure is designed to have an intentional side effect (like sorting a list), what is the best practice?",
                    type: "single-choice",
                    answers: ["It should be named in a way that suggests modification (e.g., `SortListInPlace`).", "It should be documented clearly that it modifies its input.", "It should also return the modified list.", "All of the above."],
                    correct: ["It should be documented clearly that it modifies its input."],
                    explanation: "While naming conventions are helpful, the most important practice is to have clear documentation so that anyone using the procedure understands its behavior and expects the side effect."
                }
            ];

            function renderQuiz() {
                quizContainer.innerHTML = quizQuestions.map((q, index) => {
                    const answersHtml = q.answers.map(answer => `
                        <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-300 cursor-pointer hover:bg-gray-100 transition has-[:checked]:bg-blue-100 has-[:checked]:border-blue-400">
                            <input type="${q.type === 'multiple-choice' ? 'checkbox' : 'radio'}" name="question${index}" value="${answer}" class="form-${q.type === 'multiple-choice' ? 'checkbox' : 'radio'} h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span>${answer}</span>
                        </label>
                    `).join('');
                    return `
                        <div class="quiz-question" data-question-index="${index}">
                            <p class="text-lg font-semibold mb-4">${index + 1}. ${q.question}</p>
                            <div class="space-y-3">${answersHtml}</div>
                            <button class="submit-answer mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">Submit</button>
                            <div class="feedback mt-3"></div>
                        </div>
                    `;
                }).join('');
            }

            quizContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('submit-answer')) {
                    const questionDiv = e.target.closest('.quiz-question');
                    const index = parseInt(questionDiv.dataset.questionIndex);
                    const question = quizQuestions[index];
                    const feedbackDiv = questionDiv.querySelector('.feedback');
                    
                    const selectedAnswers = Array.from(questionDiv.querySelectorAll(`input[name="question${index}"]:checked`)).map(input => input.value);
                    
                    if (selectedAnswers.length === 0) {
                        feedbackDiv.innerHTML = `<p class="text-yellow-600 font-semibold">Please select an answer.</p>`;
                        return;
                    }

                    questionDiv.querySelectorAll('input').forEach(input => input.disabled = true);
                    e.target.disabled = true;
                    e.target.classList.add('opacity-50', 'cursor-not-allowed');

                    const isCorrect = question.type === 'multiple-choice' 
                        ? (selectedAnswers.length === question.correct.length && selectedAnswers.every(sa => question.correct.includes(sa)))
                        : (selectedAnswers[0] === question.correct[0]);

                    if (isCorrect) {
                        feedbackDiv.innerHTML = `<div class="p-4 bg-green-100 border-l-4 border-green-500 text-green-700"><p class="font-bold">✅ Correct!</p><p class="mt-1">${question.explanation}</p></div>`;
                        score++;
                    } else {
                        feedbackDiv.innerHTML = `<div class="p-4 bg-red-100 border-l-4 border-red-500 text-red-700"><p class="font-bold">❌ Incorrect.</p><p class="mt-1"><strong>Correct Answer(s):</strong> ${question.correct.join(', ')}</p><p class="mt-1">${question.explanation}</p></div>`;
                    }
                    
                    const answeredQuestions = document.querySelectorAll('.submit-answer:disabled').length;
                    if (answeredQuestions === quizQuestions.length) {
                        quizResults.innerHTML = `Quiz Complete! Your Score: ${score} / ${quizQuestions.length}`;
                    }
                }
            });

            renderQuiz();
        });
    </script>
</body>
</html>
